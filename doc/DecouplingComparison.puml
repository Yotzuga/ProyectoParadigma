@startuml DecouplingComparison
!theme plain

package "❌ ACOPLADO (ANTES)" {
    component "Collision Detector" as CD
    component "Response Handler" as RH
    component "Damage Applier" as DA
    component "Health Manager" as HM
    component "UI Updater" as UI
    
    CD -.-> RH: calls directly
    RH -.-> DA: calls directly
    DA -.-> HM: calls directly
    HM -.-> UI: calls directly
    
    note right of CD
        Cada componente conoce
        al siguiente
        
        String de dependencias:
        CD → RH → DA → HM → UI
        
        Problema: Cambio en HM
        afecta a todos
    end note
}

package "✓ DESACOPLADO (CON EVENTOS)" {
    component "Collision Detector" as CD2
    component "Response Handler" as RH2
    component "Damage Applier" as DA2
    component "Health Manager" as HM2
    component "UI Updater" as UI2
    component "EventQueue" as EQ
    
    CD2 -.-> EQ: EmitEvent(CollisionEvent)
    RH2 -.-> EQ: EmitEvent(DamageEvent)
    DA2 -.-> EQ: EmitEvent(HealthChangedEvent)
    HM2 -.-> EQ: EmitEvent(GameOverEvent)
    
    EQ -.-> RH2: GetEvent
    EQ -.-> DA2: GetEvent
    EQ -.-> HM2: GetEvent
    EQ -.-> UI2: GetEvent
    
    note right of EQ
        Todos se conectan a EventQueue
        No conocen uno al otro
        
        Nuevos sistemas:
        - Agregar listener a cola
        - Sin modificar existentes
        
        Cambio en HM:
        - Solo HM afectado
        - Otros ignoran internals
    end note
}

== COMPARACIÓN ==

table
|= | ❌ ACOPLADO | ✓ DESACOPLADO |
|Dependencias| Lineales (A→B→C) | Todas → Queue |
|Escalabilidad| O(N²) relaciones | O(N) relaciones |
|Cambios| Afecta múltiples | Solo 1 componente |
|Testing| Debe mockear toda cadena | Mock solo EventQueue |
|Performance| Llamadas función directas | Dequeue overhead |
|Mantenibilidad| Muy difícil | Fácil |
|Bugs| Cascada de errores | Aislados |
end table

@enduml
